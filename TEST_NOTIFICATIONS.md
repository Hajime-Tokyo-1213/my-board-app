# 通知機能テスト手順

## 準備
1. アプリケーションを起動
```bash
npm run dev
```

2. 2つの異なるブラウザ（またはシークレットウィンドウ）を開く
   - ブラウザA: ユーザー1でログイン
   - ブラウザB: ユーザー2でログイン

## テストシナリオ

### 1. フォロー通知のテスト
**ブラウザB（ユーザー2）で:**
1. タイムラインページへ移動
2. ユーザー1の投稿からユーザー名をクリック
3. 「フォロー」ボタンをクリック

**ブラウザA（ユーザー1）で確認:**
- ベルアイコンに赤いバッジ（未読数）が表示される
- ベルアイコンをクリックすると「ユーザー2があなたをフォローしました」と表示

### 2. いいね通知のテスト
**ブラウザA（ユーザー1）で:**
1. 新しい投稿を作成

**ブラウザB（ユーザー2）で:**
1. ユーザー1の投稿にいいね（ハートアイコン）をクリック

**ブラウザA（ユーザー1）で確認:**
- ベルアイコンの未読数が増える
- 通知リストに「ユーザー2があなたの投稿「...」にいいねしました」と表示

### 3. コメント通知のテスト
**ブラウザB（ユーザー2）で:**
1. ユーザー1の投稿をクリックして詳細ページへ
2. コメントを入力して送信

**ブラウザA（ユーザー1）で確認:**
- ベルアイコンの未読数が増える
- 通知リストに「ユーザー2があなたの投稿「...」にコメントしました」と表示

### 4. リアルタイム更新のテスト
**ブラウザA（ユーザー1）で:**
1. 通知リストを開いたまま待機

**ブラウザB（ユーザー2）で:**
1. ユーザー1の別の投稿にいいね

**ブラウザA（ユーザー1）で確認:**
- 5秒以内に自動的に新しい通知が表示される（SSE接続）

### 5. 既読機能のテスト
**ブラウザA（ユーザー1）で:**
1. 通知リストから通知をクリック
   → その通知が既読になる（背景色が変わる）
2. 「すべて既読」ボタンをクリック
   → すべての通知が既読になる
   → 未読バッジが消える

### 6. 自己通知が発生しないことの確認
**ブラウザA（ユーザー1）で:**
1. 自分の投稿にいいね → 通知なし
2. 自分の投稿にコメント → 通知なし

## APIでの直接テスト

### 通知一覧の取得
```bash
# ログイン後のトークンが必要
curl http://localhost:3000/api/notifications \
  -H "Cookie: token=YOUR_TOKEN"
```

### 未読のみ取得
```bash
curl "http://localhost:3000/api/notifications?unread=true" \
  -H "Cookie: token=YOUR_TOKEN"
```

### 通知を既読にする
```bash
curl -X PUT http://localhost:3000/api/notifications \
  -H "Content-Type: application/json" \
  -H "Cookie: token=YOUR_TOKEN" \
  -d '{"markAllRead": true}'
```

## 確認ポイント
✅ 未読数が正しく表示される
✅ 通知クリックで該当ページへ遷移
✅ リアルタイム更新が動作（5秒ごと）
✅ 既読・未読の状態管理
✅ 自分の行動では通知が発生しない
✅ 通知の種類別アイコン表示
✅ 日本語の相対時間表示（「3分前」など）

## トラブルシューティング
- 通知が表示されない → ブラウザのCookie設定を確認
- リアルタイム更新しない → SSE接続状態を確認（ベルアイコンのツールチップ）
- 未読数が合わない → ページをリロードして再取得