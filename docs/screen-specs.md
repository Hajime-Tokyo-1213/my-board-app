# 画面仕様書 - 会員制掲示板システム

## 1. 画面一覧

| 画面ID | 画面名 | パス | 説明 |
|--------|--------|------|------|
| SC-001 | ホーム画面 | / | ログイン後の投稿一覧画面 |
| SC-002 | ログイン画面 | /auth/signin | ユーザーログイン画面 |
| SC-003 | ユーザー登録画面 | /auth/signup | 新規ユーザー登録画面 |
| SC-004 | 投稿詳細画面 | /posts/[id] | 投稿の詳細とコメント表示 |
| SC-005 | 投稿編集画面 | /posts/[id]/edit | 投稿の編集フォーム |
| SC-006 | 新規投稿画面 | /posts/new | 新規投稿作成フォーム |
| SC-007 | プロフィール画面 | /profile | ユーザー情報表示・編集 |

## 2. 画面詳細

### 2.1 ホーム画面（SC-001）

#### 2.1.1 画面概要
- **目的**: ログイン後のメイン画面として投稿一覧を表示し、新規投稿への導線を提供
- **認証**: 必須（未認証時は自動的にログイン画面へリダイレクト）
- **レイアウト**: AppBar + Container + 投稿一覧

#### 2.1.2 画面構成

```
┌─────────────────────────────────────────────────────────┐
│ AppBar: 会員制掲示板    [UserName] [Avatar] [Menu▼]      │
│                        │├─ プロフィール               │
│                        │└─ ログアウト                 │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│              会員制掲示板                                 │
│           会員限定の掲示板です                             │
│          ようこそ、[ユーザー名]さん                        │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│ 新しい投稿を作成                                          │
│ [+ 新規投稿を作成]                                       │
└─────────────────────────────────────────────────────────┘

投稿一覧 (X件)

┌─────────────────────────────────────────────────────────┐
│ 投稿タイトル                                              │
│ [Avatar] 投稿者名  2024/12/26 15:30 [あなたの投稿]       │
│ 投稿内容プレビュー（3行まで）                              │
│ [♡ X] [詳細を見る] [編集] [🗑️]                           │
└─────────────────────────────────────────────────────────┘

[ページネーション]
```

#### 2.1.3 構成要素

##### AppBar（ヘッダー）
- **背景色**: primary.main
- **高さ**: 64px（固定）
- **要素**:
  - タイトル: "会員制掲示板"
  - ユーザー名表示
  - アバター（UserAvatar または AccountCircle）
  - ドロップダウンメニュー

##### ウェルカムセクション
- **背景**: primary.main（グラデーション対応）
- **レスポンシブフォントサイズ**:
  - xs: 1.75rem, sm: 2.5rem, md: 3rem
- **要素**:
  - メインタイトル
  - サブタイトル
  - ユーザー向けウェルカムチップ

##### PostForm コンポーネント
- **機能**: 新規投稿画面への導線
- **構成**: ボタン一つのシンプルな形式
- **ボタンスタイル**: 
  - variant: contained
  - fullWidth: true
  - アイコン: Add

##### 投稿一覧
- **表示形式**: PostCard コンポーネントの配列
- **ページネーション**: 1ページ10件
- **空状態**: "まだ投稿がありません。最初の投稿をしてみましょう！"

#### 2.1.4 レスポンシブ対応

| ブレークポイント | 幅 | Container maxWidth | Padding |
|----------------|-----|-------------------|---------|
| xs | < 600px | full | 2 |
| sm | 600-900px | md | 3 |
| md | 900-1200px | md | 4 |
| lg | > 1200px | md | 4 |

### 2.2 ログイン画面（SC-002）

#### 2.2.1 画面概要
- **目的**: メールアドレスとパスワードによる認証
- **認証**: 不要（認証済みユーザーは自動的にホーム画面へリダイレクト）
- **レイアウト**: 全画面グラデーション背景 + 中央配置フォーム

#### 2.2.2 画面構成

```
┌─────────────────────────────────────────────────────────┐
│ [グラデーション背景: #667eea → #764ba2]                    │
│                                                         │
│       ┌─────────────────────────────────────┐           │
│       │ [Forum Icon]                        │           │
│       │                                     │           │
│       │ ログイン                             │           │
│       │ 会員制掲示板へようこそ                 │           │
│       │                                     │           │
│       │ [Alert: エラーメッセージ]             │           │
│       │                                     │           │
│       │ [📧] メールアドレス                  │           │
│       │ [🔒] パスワード [👁]                │           │
│       │                                     │           │
│       │ [ログイン]                          │           │
│       │                                     │           │
│       │ パスワードをお忘れですか？             │           │
│       │                                     │           │
│       │ ──── または ────                   │           │
│       │                                     │           │
│       │ アカウントをお持ちでない方は           │           │
│       │ [新規登録]                          │           │
│       └─────────────────────────────────────┘           │
└─────────────────────────────────────────────────────────┘
```

#### 2.2.3 入力項目と検証ルール

| 項目 | 型 | 必須 | 最大長 | 検証ルール |
|------|---|------|--------|-----------|
| メールアドレス | email | ○ | - | 有効なメール形式 |
| パスワード | password | ○ | - | - |

#### 2.2.4 入力フィールド仕様

##### メールアドレス
- **アイコン**: EmailIcon
- **autoComplete**: "email"
- **autoFocus**: true

##### パスワード
- **アイコン**: LockIcon
- **表示切替**: Visibility/VisibilityOff アイコン
- **autoComplete**: "current-password"

#### 2.2.5 エラー処理
- **表示位置**: フォーム上部
- **コンポーネント**: Alert (severity="error")
- **メッセージ例**: "ログインに失敗しました"

### 2.3 ユーザー登録画面（SC-003）

#### 2.3.1 画面概要
- **目的**: 新規ユーザーアカウントの作成
- **認証**: 不要
- **レイアウト**: Container + Paper

#### 2.3.2 画面構成

```
┌─────────────────────────────────────────────────────────┐
│ 新規登録                                                  │
│ 会員制掲示板に参加しよう                                    │
│                                                         │
│ [Alert: エラーメッセージ]                                 │
│                                                         │
│ [👤] 名前                                               │
│ [📧] メールアドレス                                       │
│ [🔒] パスワード（8文字以上） [👁]                          │
│ パスワード強度 [Progress Bar]                             │
│ [🔒] パスワード（確認） [👁]                              │
│                                                         │
│ [登録]                                                   │
│                                                         │
│ ──── または ────                                       │
│                                                         │
│ すでにアカウントをお持ちの方は                              │
│ ログイン                                                 │
└─────────────────────────────────────────────────────────┘
```

#### 2.3.3 入力項目と検証ルール

| 項目 | 型 | 必須 | 最大長 | 検証ルール |
|------|---|------|--------|-----------|
| 名前 | text | ○ | - | 空文字不可 |
| メールアドレス | email | ○ | - | 有効なメール形式 |
| パスワード | password | ○ | - | 8文字以上 |
| パスワード確認 | password | ○ | - | パスワードと一致 |

#### 2.3.4 パスワード強度表示
- **コンポーネント**: LinearProgress
- **強度計算**:
  - 8文字以上: +25%
  - 大文字・小文字混在: +25%
  - 数字含む: +25%
  - 特殊文字含む: +25%
- **色分け**:
  - < 50%: error.main
  - 50-74%: warning.main
  - ≥ 75%: success.main

#### 2.3.5 成功画面
- **表示**: CheckCircle アイコン
- **メッセージ**: "確認メールを送信しました。メール内のリンクをクリックして、メールアドレスを確認してください。"
- **アクション**: "ログインページへ" ボタン

### 2.4 投稿詳細画面（SC-004）

#### 2.4.1 画面概要
- **目的**: 投稿の詳細内容といいね機能の提供
- **認証**: 必須
- **レイアウト**: Container + Paper

#### 2.4.2 画面構成

```
┌─────────────────────────────────────────────────────────┐
│ [← 戻る]                                               │
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 投稿タイトル                                          │ │
│ │                                                     │ │
│ │ [Avatar] 投稿者名                                   │ │
│ │ 2024/12/26 15:30                                   │ │
│ │                                                     │ │
│ │ [♡ X] X いいね                                      │ │
│ │                                                     │ │
│ │ [編集] [削除] (投稿者のみ)                          │ │
│ │                                                     │ │
│ │ ──────────────────────────                        │ │
│ │                                                     │ │
│ │ 投稿内容（改行対応）                                  │ │
│ │                                                     │ │
│ │ 最終更新: 2024/12/26 16:00 (編集された場合)         │ │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

#### 2.4.3 機能要素

##### いいね機能
- **アイコン**: Favorite/FavoriteBorder
- **状態管理**: ユーザーごとの個別状態
- **API**: POST /api/posts/[id]/like
- **レスポンス**: liked状態とlikesCount

##### 投稿者専用機能
- **表示条件**: session.user.id === post.authorId
- **編集ボタン**: Edit アイコン → /posts/[id]/edit へ遷移
- **削除ボタン**: Delete アイコン → 確認ダイアログ → 削除API実行

### 2.5 投稿編集画面（SC-005）

#### 2.5.1 画面概要
- **目的**: 既存投稿の編集
- **認証**: 必須（投稿者のみアクセス可能）
- **レイアウト**: Container + Paper

#### 2.5.2 画面構成

```
┌─────────────────────────────────────────────────────────┐
│ [← 戻る]                                               │
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 投稿を編集                                            │ │
│ │                                                     │ │
│ │ [Alert: エラーメッセージ]                           │ │
│ │                                                     │ │
│ │ タイトル                                            │ │
│ │ [________________] 50/100文字                       │ │
│ │                                                     │ │
│ │ 本文                                                │ │
│ │ [________________]                                  │ │
│ │ [________________] 500/1000文字                     │ │
│ │ [________________]                                  │ │
│ │                                                     │ │
│ │ [更新する] [キャンセル]                             │ │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

#### 2.5.3 入力項目と検証ルール

| 項目 | 型 | 必須 | 最大長 | 検証ルール |
|------|---|------|--------|-----------|
| タイトル | text | ○ | 100 | 空文字不可 |
| 本文 | textarea | ○ | 1000 | 空文字不可 |

#### 2.5.4 セキュリティ
- **権限チェック**: サーバーサイドで投稿者確認
- **エラー時の動作**: "他のユーザーの投稿は編集できません" → 2秒後にホーム画面へリダイレクト

### 2.6 新規投稿画面（SC-006）

#### 2.6.1 画面概要
- **目的**: 新しい投稿の作成
- **認証**: 必須
- **レイアウト**: Container + Paper

#### 2.6.2 画面構成

```
┌─────────────────────────────────────────────────────────┐
│ [← 戻る]                                               │
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 新規投稿                                              │ │
│ │                                                     │ │
│ │ [Alert: エラーメッセージ]                           │ │
│ │                                                     │ │
│ │ タイトル                                            │ │
│ │ [________________] 0/100文字                        │ │
│ │                                                     │ │
│ │ 本文                                                │ │
│ │ [________________]                                  │ │
│ │ [________________] 0/1000文字                       │ │
│ │ [________________]                                  │ │
│ │                                                     │ │
│ │ [投稿する] [キャンセル]                             │ │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

#### 2.6.3 入力仕様
- **投稿編集画面と同様の仕様**
- **違い**: 初期値が空文字

### 2.7 プロフィール画面（SC-007）

#### 2.7.1 画面概要
- **目的**: ユーザー情報の表示と編集アクセス
- **認証**: 必須
- **レイアウト**: Container + Paper

#### 2.7.2 画面構成

```
┌─────────────────────────────────────────────────────────┐
│ [🏠 掲示板トップへ戻る]                                  │
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [Avatar] ユーザー名                    [プロフィール編集] │ │
│ │          [メール認証済み]              [パスワード変更]   │ │
│ │                                                     │ │
│ │ ──────────────────────────                        │ │
│ │                                                     │ │
│ │ 📧 メールアドレス                                    │ │
│ │ user@example.com                                   │ │
│ │                                                     │ │
│ │ 👤 名前                                             │ │
│ │ ユーザー名                                           │ │
│ │                                                     │ │
│ │ 📝 自己紹介                                         │ │
│ │ 自己紹介が設定されていません                          │ │
│ │                                                     │ │
│ │ 📅 登録日                                           │ │
│ │ 2024年12月26日                                      │ │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

#### 2.7.3 表示要素

##### ユーザー情報
- **アバター**: UserAvatar（80px）
- **メール認証バッジ**: emailVerified が true の場合表示
- **各情報項目**: アイコン + ラベル + 値

##### アクションボタン
- **プロフィール編集**: /profile/edit へ遷移
- **パスワード変更**: /profile/password へ遷移

## 3. 共通コンポーネント

### 3.1 PostCard コンポーネント

#### 3.1.1 表示要素
- **投稿タイトル**: Typography h6
- **投稿者情報**: Avatar + 名前 + 投稿日時
- **投稿内容**: 3行までのプレビュー（-webkit-line-clamp）
- **いいね機能**: ハートアイコン + カウント
- **アクションボタン**: 詳細表示、編集（投稿者のみ）、削除（投稿者のみ）

#### 3.1.2 レスポンシブ対応
- **カードレイアウト**: モバイルでも崩れない設計
- **ボタン配置**: Stack コンポーネントで整列

### 3.2 PostForm コンポーネント

#### 3.1.1 機能
- **現在の実装**: 新規投稿画面への導線のみ
- **デザイン**: Paper + Button の シンプルな構成

### 3.3 UserProfileModal コンポーネント

#### 3.3.1 表示内容
- **ユーザー情報**: 名前、メール、自己紹介、登録日
- **レイアウト**: Dialog + DialogContent
- **アバター**: UserAvatar（80px）

#### 3.3.2 呼び出し条件
- **投稿カードのユーザー名/アバタークリック時**
- **API**: GET /api/users/[userId]

### 3.4 UserAvatar コンポーネント

#### 3.4.1 機能
- **文字ベースアバター**: ユーザー名の頭文字を表示
- **カラー**: ユーザー名に基づく一意の背景色生成
- **サイズ**: props で指定可能

## 4. 画面遷移図

```
[ログイン画面] ──登録リンク──→ [ユーザー登録画面]
       │                           │
    ログイン成功                 登録成功
       ↓                           ↓
[ホーム画面] ←─────────────────→ [ログイン画面]
    │  │
    │  └─新規投稿──→ [新規投稿画面] ──投稿──→ [ホーム画面]
    │
    ├─投稿詳細──→ [投稿詳細画面]
    │                  │
    │               編集ボタン
    │                  ↓
    │             [投稿編集画面] ──更新──→ [投稿詳細画面]
    │
    └─プロフィール──→ [プロフィール画面]
```

## 5. レスポンシブ対応

### 5.1 ブレークポイント

| サイズ | 幅 | 主な調整内容 |
|--------|---|-------------|
| xs | < 600px | モバイル最適化、フォントサイズ縮小、パディング調整 |
| sm | 600-900px | タブレット対応、中間サイズ |
| md | 900-1200px | 標準デスクトップ |
| lg | > 1200px | 大画面対応 |

### 5.2 調整項目
- **フォントサイズ**: タイトルのレスポンシブ対応
- **パディング**: { xs: 2, sm: 3, md: 4 }
- **Container幅**: maxWidth="md" で統一

## 6. エラー処理とメッセージ

### 6.1 エラーメッセージ一覧

| エラーコード | メッセージ | 表示条件 |
|-------------|-----------|----------|
| AUTH-001 | ログインに失敗しました | 認証エラー |
| AUTH-002 | すべての項目を入力してください | 必須項目未入力 |
| AUTH-003 | パスワードは8文字以上で入力してください | パスワード不足 |
| AUTH-004 | パスワードが一致しません | 確認パスワード不一致 |
| POST-001 | タイトルと本文を入力してください | 投稿必須項目未入力 |
| POST-002 | 投稿の取得に失敗しました | 投稿データ取得エラー |
| POST-003 | 投稿の作成に失敗しました | 投稿作成エラー |
| POST-004 | 投稿の更新に失敗しました | 投稿更新エラー |
| POST-005 | 投稿の削除に失敗しました | 投稿削除エラー |
| POST-006 | 他のユーザーの投稿は編集できません | 権限エラー |
| LIKE-001 | いいねの処理に失敗しました | いいね機能エラー |
| USER-001 | ユーザー情報の取得に失敗しました | ユーザー情報取得エラー |
| SYS-001 | サーバーエラーが発生しました | 汎用システムエラー |

### 6.2 エラー表示仕様
- **コンポーネント**: Material UI Alert
- **severity**: error
- **表示位置**: フォーム上部または画面上部
- **クローズ機能**: onClose prop でクリア可能
- **自動非表示**: なし（ユーザーが明示的にクローズ）

## 7. ローディング表示

### 7.1 表示パターン

#### 全画面ローディング
- **使用箇所**: ページ初回読み込み、認証チェック
- **表示内容**: CircularProgress を画面中央に配置
- **スタイル**: height: '100vh', 中央配置

#### インラインローディング
- **使用箇所**: ボタン内、フォーム送信中
- **表示内容**: CircularProgress + テキスト
- **例**: "ログイン中...", "投稿中...", "更新中..."

#### ボタンローディング
- **無効化**: disabled={loading}
- **アイコン置換**: 通常アイコン → CircularProgress

### 7.2 ローディング状態管理
- **状態変数**: isLoading, submitting など
- **開始**: API呼び出し直前に true
- **終了**: API完了後（成功/失敗問わず）finally で false

## 8. アクセシビリティ

### 8.1 キーボード操作
- **Tab**: フォーカス移動（logical tab order）
- **Enter**: フォーム送信、ボタン実行
- **Escape**: モーダル/ダイアログクローズ
- **Space**: ボタン実行

### 8.2 スクリーンリーダー対応
- **aria-label**: ボタンの説明
- **alt**: 画像の代替テキスト
- **role**: 要素の役割明示
- **フォーカス管理**: モーダル内フォーカストラップ

### 8.3 コントラスト比
- **テキスト**: WCAG 2.1 AA準拠（4.5:1以上）
- **インタラクティブ要素**: 3:1以上
- **Material UI**: デフォルトで準拠済み

## 9. セキュリティ考慮事項

### 9.1 認証・認可
- **セッション管理**: NextAuth.js
- **ページ保護**: useSession + リダイレクト
- **API保護**: サーバーサイドセッション確認

### 9.2 入力検証
- **クライアント**: 必須項目、文字数制限
- **サーバー**: 同等の検証 + XSS対策
- **SQLインジェクション**: MongoDBでのクエリ設計

### 9.3 投稿権限
- **編集/削除**: 投稿者本人のみ
- **いいね**: ログインユーザーのみ
- **プロフィール**: 本人のみ閲覧・編集

## 10. パフォーマンス最適化

### 10.1 画像・リソース
- **アバター**: 文字ベース（軽量）
- **アイコン**: Material UI Icons（SVG）
- **フォント**: システムフォント優先

### 10.2 データフェッチング
- **ページネーション**: 10件ずつ
- **遅延読み込み**: モーダル内ユーザー情報
- **キャッシュ**: ブラウザキャッシュ活用

### 10.3 レンダリング最適化
- **memo化**: 必要に応じて React.memo 使用
- **state最適化**: 適切な state 分割
- **不要な再レンダリング**: useCallback, useMemo で抑制