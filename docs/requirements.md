# 要件定義書

## 1. システム概要

### 1.1 システム名
掲示板アプリケーション（My Board App）

### 1.2 システムの目的
ユーザーが投稿を作成・編集・削除・閲覧できる掲示板システムを提供し、ユーザー間のコミュニケーションを促進する。

### 1.3 システムの特徴
- **リアルタイム性**: 投稿の即時反映
- **セキュリティ**: 包括的なセキュリティ対策
- **使いやすさ**: 直感的なUI/UX
- **レスポンシブ**: モバイル対応

---

## 2. 機能要件

### 2.1 ユーザー管理機能

#### 2.1.1 ユーザー登録
- **概要**: 新規ユーザーのアカウント作成
- **入力項目**:
  - 名前（必須、50文字以内）
  - メールアドレス（必須、一意）
  - パスワード（必須、8文字以上、英数字混在）
- **処理内容**:
  - パスワードのハッシュ化（bcrypt）
  - メール認証の送信
  - MongoDBへのユーザー情報保存

#### 2.1.2 ログイン/ログアウト
- **概要**: ユーザー認証とセッション管理
- **実装**: NextAuth.jsによる認証
- **セッション**: JWTトークン方式
- **有効期限**: 30日間

#### 2.1.3 パスワードリセット
- **概要**: パスワード忘れ時の再設定機能
- **プロセス**:
  1. メールアドレス入力
  2. リセットトークン送信
  3. 新パスワード設定
  4. トークン検証と更新

### 2.2 投稿管理機能

#### 2.2.1 投稿の作成（Create）
- **入力項目**:
  - タイトル（必須、100文字以内）
  - 本文（必須、1000文字以内）
- **権限**: ログインユーザーのみ
- **処理**: XSS対策のサニタイゼーション実施

#### 2.2.2 投稿の一覧表示（Read）
- **表示項目**:
  - タイトル
  - 本文（3行まで表示）
  - 投稿者名とアバター
  - 投稿日時
  - いいね数
- **ソート順**: 新着順（作成日時降順）
- **ページネーション**: 10件/ページ

#### 2.2.3 投稿の詳細表示
- **表示項目**:
  - 全文表示
  - 投稿者情報
  - 作成日時・更新日時
  - いいねボタンと数
- **権限**: ログインユーザーのみ

#### 2.2.4 投稿の編集（Update）
- **権限**: 投稿者本人のみ
- **編集可能項目**: タイトル、本文
- **制限**: 文字数制限は作成時と同じ

#### 2.2.5 投稿の削除（Delete）
- **権限**: 投稿者本人のみ
- **確認**: 削除確認ダイアログ表示
- **処理**: 物理削除

### 2.3 いいね機能

#### 2.3.1 いいねの追加/削除
- **権限**: ログインユーザーのみ
- **制限**: 1投稿につき1ユーザー1いいねまで
- **表示**: ハートアイコンで表現
- **カウント**: リアルタイム更新

### 2.4 ユーザープロフィール機能

#### 2.4.1 プロフィール表示
- **表示項目**:
  - ユーザー名
  - メールアドレス
  - 登録日
  - アバター（名前から自動生成）
- **表示方法**: モーダルダイアログ

---

## 3. 非機能要件

### 3.1 性能要件
- **レスポンスタイム**: 3秒以内（通常操作）
- **同時接続数**: 100ユーザー
- **データ容量**: 
  - 投稿: 最大10万件
  - ユーザー: 最大1万人

### 3.2 セキュリティ要件

#### 3.2.1 実装済みセキュリティ対策
- **XSS対策**: DOMPurifyによるサニタイゼーション
- **CSRF対策**: NextAuthの組み込み保護
- **SQLインジェクション対策**: パラメータ化クエリ
- **レート制限**: 
  - 認証: 5回/分
  - 投稿作成: 5回/分
  - いいね: 30回/分
- **セキュリティヘッダー**:
  - Content-Security-Policy
  - X-Frame-Options
  - X-Content-Type-Options
  - X-XSS-Protection
  - Referrer-Policy
  - Permissions-Policy

#### 3.2.2 認証・認可
- **パスワード**: bcryptによるハッシュ化
- **セッション**: JWT方式
- **タイムアウト**: 30分（無操作時）

### 3.3 可用性要件
- **稼働率**: 99%以上（月間）
- **バックアップ**: 日次自動バックアップ
- **復旧時間**: 4時間以内

### 3.4 ユーザビリティ要件
- **対応ブラウザ**:
  - Chrome（最新版）
  - Firefox（最新版）
  - Safari（最新版）
  - Edge（最新版）
- **対応デバイス**:
  - デスクトップPC
  - タブレット
  - スマートフォン
- **言語**: 日本語
- **アクセシビリティ**: WCAG 2.1 レベルA準拠

### 3.5 保守性要件
- **コード品質**:
  - TypeScriptによる型安全性
  - ESLintによるコード規約統一
  - Prettierによるフォーマット統一
- **テスト**:
  - 単体テスト（Jest）
  - 統合テスト
  - E2Eテスト（Playwright）
- **ドキュメント**:
  - 仕様書の整備
  - APIドキュメント
  - テストガイド

---

## 4. システム構成

### 4.1 技術スタック

#### フロントエンド
- **フレームワーク**: Next.js 15.4.5
- **言語**: TypeScript 5.x
- **UIライブラリ**: Material-UI (MUI) 7.3.1
- **状態管理**: React Hooks
- **スタイリング**: Emotion

#### バックエンド
- **フレームワーク**: Next.js API Routes
- **認証**: NextAuth.js 4.24.11
- **データベース接続**: Mongoose 8.17.0

#### データベース
- **種類**: MongoDB
- **ODM**: Mongoose
- **接続管理**: 接続プール

#### インフラ
- **ホスティング**: Vercel（推奨）
- **データベース**: MongoDB Atlas
- **メール送信**: Nodemailer

### 4.2 ディレクトリ構成
```
my-board-app/
├── app/              # Next.js App Router
│   ├── api/         # APIエンドポイント
│   ├── auth/        # 認証関連ページ
│   └── posts/       # 投稿関連ページ
├── components/       # Reactコンポーネント
├── lib/             # ユーティリティ
├── models/          # Mongooseモデル
├── docs/            # ドキュメント
└── scripts/         # スクリプト
```

---

## 5. 制約事項

### 5.1 技術的制約
- Node.js 18.x以上が必要
- MongoDB 5.0以上が必要
- JavaScriptが有効なブラウザが必要

### 5.2 運用上の制約
- 24時間365日の運用は保証しない
- 定期メンテナンスあり（月1回、深夜帯）
- 個人情報の取り扱いはプライバシーポリシーに準拠

### 5.3 法的制約
- 利用規約の同意が必要
- 13歳未満の利用禁止
- 著作権侵害コンテンツの投稿禁止

---

## 6. 今後の拡張予定

### Phase 2（3ヶ月以内）
- コメント機能の追加
- 画像アップロード機能
- タグ・カテゴリー機能
- 検索機能の強化

### Phase 3（6ヶ月以内）
- リアルタイム通知
- ダイレクトメッセージ
- ユーザーフォロー機能
- 投稿のお気に入り機能

### Phase 4（1年以内）
- モバイルアプリ版
- 多言語対応
- AI による不適切コンテンツ検出
- 分析ダッシュボード

---

## 7. 用語定義

| 用語 | 説明 |
|-----|------|
| ユーザー | システムに登録済みの利用者 |
| 投稿 | ユーザーが作成したコンテンツ |
| いいね | 投稿への好意的な評価 |
| セッション | ログイン状態の維持期間 |
| サニタイゼーション | 悪意のあるコードを無害化する処理 |
| レート制限 | 一定時間内のリクエスト数制限 |

---

## 8. 改訂履歴

| 版 | 日付 | 内容 | 作成者 |
|----|------|------|--------|
| 1.0 | 2025-08-16 | 初版作成 | Claude Code |

---

## 9. 承認

| 役割 | 氏名 | 承認日 |
|------|------|--------|
| プロジェクトマネージャー | - | - |
| 技術責任者 | - | - |
| 品質保証責任者 | - | - |